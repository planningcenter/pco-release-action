name: PCO Release - Release by PR
description: A tool for creating and managing releases for PCO projects through Pull Requests.

inputs:
  GITHUB_TOKEN:
    description: token for access
    required: false
  app-id:
    description: 'The app id for the github app'
    required: false
  private-key:
    description: 'The private key for the github app'
    required: false
  release_type:
    required: false
    default: nochange
  package_json_path:
    description: 'The path to the package.json file to version.'
    required: false
    default: 'package.json'
  version_command:
    description: 'The command to run to bump the version'
    required: false
    default: 'yarn version'

runs:
  using: 'composite'
  steps:
    - name: Generate a token
      if: ${{ inputs.app-id && inputs.private-key }}
      id: generate-token
      uses: actions/create-github-app-token@v1
      with:
        app-id: ${{ inputs.app-id }}
        private-key: ${{ inputs.private-key }}
        owner: ${{ github.repository_owner }}
    - name: Run release by PR
      shell: bash
      run: node ${{ github.action_path }}/dist/index.js
      env:
        GITHUB_TOKEN: ${{ steps.generate-token.outputs.token || inputs.GITHUB_TOKEN }}
        INPUT_RELEASE_TYPE: ${{ inputs.release_type }}
        INPUT_PACKAGE_JSON_PATH: ${{ inputs.package_json_path }}
        INPUT_VERSION_COMMAND: ${{ inputs.version_command }}
